<ion-header [translucent]="true">
  <ion-toolbar>
    <!-- Show back button during session -->
    <ion-buttons slot="start" *ngIf="isSessionActive">
      <ion-button (click)="goToDecks()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    
    <!-- Show title when no session active -->
    <ion-title *ngIf="!isSessionActive">Flashcards</ion-title>
    
    <!-- Show progress during session - size="small" prevents truncation -->
    <ion-title *ngIf="isSessionActive" size="small">{{ currentCardNumber }}/{{ totalCardsInSession }}</ion-title>
    
    <!-- Header Action Buttons -->
    <ion-buttons slot="end" *ngIf="isSessionActive">
      <!-- Edit Card Button -->
      <ion-button 
        *ngIf="currentCard"
        fill="clear" 
        (click)="openCardActions()">
        <ion-icon name="create-outline"></ion-icon>
      </ion-button>
      
      <!-- Copy Button -->
      <ion-button 
        fill="clear" 
        (click)="showCopyCardOptions()">
        <ion-icon name="copy"></ion-icon>
      </ion-button>

      <!-- Add Word to Story Category Button -->
      <ion-button 
        *ngIf="currentCard"
        fill="clear"
        (click)="addWordToStoryCategory()">
        <ion-icon name="bookmark-outline"></ion-icon>
      </ion-button>
      
      <!-- Translation Toggle Button -->
      <ion-button 
        *ngIf="currentCard?.englishTranslation"
        fill="clear" 
        (click)="showTranslation = !showTranslation">
        <ion-icon name="language"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="no-padding" [scrollY]="false">
  <!-- Remove collapsible header that causes duplicate title on iOS -->

  <!-- Session Active -->
  <div *ngIf="isSessionActive && currentCard" class="session-container no-padding">
    <!-- Fill in the Blank Card -->
    <div *ngIf="currentCard.type === 'fill-blank'" class="card-container" (click)="flipCard()">
      <div class="flashcard" [class.flipped]="isFlipped">
        <div class="card-front">
          <div class="card-content">
            <h2>{{ currentCard.sentenceFront }}</h2>
            <p class="hint">Tap to reveal answer</p>
            <p *ngIf="showTranslation && currentCard.englishTranslation" class="translation">
              {{ currentCard.englishTranslation }}
            </p>
          </div>
        </div>
        
        <div class="card-back">
          <div class="card-content">
            <h2 [innerHTML]="highlightedBack"></h2>
            <p *ngIf="showTranslation && currentCard.englishTranslation" class="translation">
              {{ currentCard.englishTranslation }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Picture Word Card -->
    <div *ngIf="currentCard.type === 'picture-word'" class="card-container" (click)="flipCard()">
      <div class="flashcard" [class.flipped]="isFlipped">
        <!-- Show Spanish word first or images first based on showWordFirst -->
        <div class="card-front" *ngIf="currentCard.showWordFirst">
          <div class="card-content">
            <h2>{{ currentCard.spanishWord }}</h2>
            <p class="hint">Tap to see images</p>
            <p *ngIf="showTranslation && currentCard.englishTranslation" class="translation">
              {{ currentCard.englishTranslation }}
            </p>
          </div>
        </div>
        
        <div class="card-front" *ngIf="!currentCard.showWordFirst">
          <div class="images-grid" *ngIf="currentCard.imageUrls && currentCard.imageUrls.length > 0; else noImages">
            <img 
              *ngFor="let imageUrl of currentCard.imageUrls.slice(0, 4)" 
              [src]="imageUrl" 
              [alt]="currentCard.spanishWord"
              (error)="$event.target.style.display='none'"
              class="card-image"
            />
          </div>
          <ng-template #noImages>
            <div class="no-images">
              <ion-icon name="image-outline" size="large"></ion-icon>
              <p>No images available</p>
            </div>
          </ng-template>
          <p *ngIf="showTranslation && currentCard.englishTranslation" class="translation">
            {{ currentCard.englishTranslation }}
          </p>
        </div>
        
        <div class="card-back" *ngIf="currentCard.showWordFirst">
          <div class="card-content">
            <div class="images-grid" *ngIf="currentCard.imageUrls && currentCard.imageUrls.length > 0">
              <img *ngFor="let imageUrl of currentCard.imageUrls.slice(0, 4)" 
                   [src]="imageUrl" 
                   [alt]="currentCard.spanishWord"
              />
            </div>
            <div *ngIf="!currentCard.imageUrls || currentCard.imageUrls.length === 0" class="no-images">
              <ion-icon name="image-outline" size="large"></ion-icon>
              <p>No images available</p>
            </div>
            <p *ngIf="showTranslation && currentCard.englishTranslation" class="translation">
              {{ currentCard.englishTranslation }}
            </p>
          </div>
        </div>
        
        <div class="card-back" *ngIf="!currentCard.showWordFirst">
          <h2>{{ currentCard.spanishWord }}</h2>
          <p *ngIf="showTranslation && currentCard.englishTranslation" class="translation">
            {{ currentCard.englishTranslation }}
          </p>
        </div>
      </div>
    </div>

    <!-- Translate Card -->
    <div *ngIf="currentCard.type === 'translate'" class="card-container" (click)="flipCard()">
      <div class="flashcard" [class.flipped]="isFlipped">
        <!-- Front: Always show, content depends on showTargetLanguageFirst -->
        <div class="card-front">
          <div class="card-content">
            <h2>{{ currentCard.showTargetLanguageFirst ? currentCard.targetLanguageWord : currentCard.englishTranslation }}</h2>
            <p class="hint">{{ currentCard.showTargetLanguageFirst ? 'Translate to English' : 'Translate to target language' }}</p>
          </div>
        </div>
        
        <!-- Back: Always show, content depends on showTargetLanguageFirst -->
        <div class="card-back">
          <div class="card-content">
            <h2>{{ currentCard.showTargetLanguageFirst ? currentCard.englishTranslation : currentCard.targetLanguageWord }}</h2>
          </div>
        </div>
      </div>
    </div>

    <!-- Centered Listen Button Above Tabs -->
    <div class="listen-button-container">
      <ion-button 
        fill="clear" 
        size="large"
        class="listen-button"
        (click)="speak()">
        <ion-icon name="volume-high" size="large"></ion-icon>
      </ion-button>
    </div>

    <!-- Review Actions Tab Bar - Inside ion-content -->
    <div class="review-tab-bar" *ngIf="currentCard && showReviewButtons" (click)="debugBarClick($event)">
      <button class="review-tab again-tab" (click)="markIncorrect()">
        <ion-icon name="close"></ion-icon>
        <span class="tab-label">Again</span>
      </button>
      <button class="review-tab hard-tab" (click)="markCorrect('hard')">
        <ion-icon name="thumbs-down"></ion-icon>
        <span class="tab-label">Hard</span>
      </button>
      <button class="review-tab good-tab" (click)="markCorrect('normal')">
        <ion-icon name="thumbs-up"></ion-icon>
        <span class="tab-label">Good</span>
      </button>
      <button class="review-tab easy-tab" (click)="markCorrect('easy')">
        <ion-icon name="checkmark"></ion-icon>
        <span class="tab-label">Easy</span>
      </button>
    </div>
  </div>
</ion-content>

<!-- No Active Session -->
<div *ngIf="!isSessionActive" class="no-session">
  <!-- Welcome content removed as requested -->
</div>
