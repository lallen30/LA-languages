<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Settings</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="settings-container">
    <!-- Appearance -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Appearance</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-icon name="moon" slot="start"></ion-icon>
          <ion-label>Dark Mode</ion-label>
          <ion-toggle [(ngModel)]="settings.darkMode" (ionChange)="onDarkModeChange()"></ion-toggle>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Color Customization -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="color-palette" style="margin-right: 8px;"></ion-icon>
          Color Customization
          <span class="mode-indicator">{{ settings.darkMode ? '(Dark Mode)' : '(Light Mode)' }}</span>
        </ion-card-title>
        <ion-card-subtitle>Customize colors for {{ settings.darkMode ? 'dark' : 'light' }} mode</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <!-- Primary Colors -->
        <div class="color-section">
          <h4>Primary Colors</h4>
          <ion-item button (click)="openCustomColorPicker('primary', 'Primary Color', $event)">
            <ion-label>Primary Color</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.primary"></div>
              <span class="color-hex">{{ currentColorScheme.primary }}</span>
            </div>
          </ion-item>
          <ion-item button (click)="openCustomColorPicker('secondary', 'Secondary Color', $event)">
            <ion-label>Secondary Color</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.secondary"></div>
              <span class="color-hex">{{ currentColorScheme.secondary }}</span>
            </div>
          </ion-item>
          <ion-item button (click)="openCustomColorPicker('tertiary', 'Tertiary Color', $event)">
            <ion-label>Tertiary Color</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.tertiary"></div>
              <span class="color-hex">{{ currentColorScheme.tertiary }}</span>
            </div>
          </ion-item>
        </div>

        <!-- Background Colors -->
        <div class="color-section">
          <h4>Backgrounds</h4>
          <ion-item button (click)="openCustomColorPicker('background', 'Page Background', $event)">
            <ion-label>Page Background</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.background"></div>
              <span class="color-hex">{{ currentColorScheme.background }}</span>
            </div>
          </ion-item>
          <ion-item button (click)="openCustomColorPicker('cardBackground', 'Card Background', $event)">
            <ion-label>Card Background</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.cardBackground"></div>
              <span class="color-hex">{{ currentColorScheme.cardBackground }}</span>
            </div>
          </ion-item>
          <ion-item button (click)="openCustomColorPicker('headerBackground', 'Header Background', $event)">
            <ion-label>Header Background</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.headerBackground"></div>
              <span class="color-hex">{{ currentColorScheme.headerBackground }}</span>
            </div>
          </ion-item>
        </div>

        <!-- Text Colors -->
        <div class="color-section">
          <h4>Text Colors</h4>
          <ion-item button (click)="openCustomColorPicker('textPrimary', 'Primary Text', $event)">
            <ion-label>Primary Text</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.textPrimary"></div>
              <span class="color-hex">{{ currentColorScheme.textPrimary }}</span>
            </div>
          </ion-item>
          <ion-item button (click)="openCustomColorPicker('textSecondary', 'Secondary Text', $event)">
            <ion-label>Secondary Text</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.textSecondary"></div>
              <span class="color-hex">{{ currentColorScheme.textSecondary }}</span>
            </div>
          </ion-item>
          <ion-item button (click)="openCustomColorPicker('headerText', 'Header Text', $event)">
            <ion-label>Header Text</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.headerText"></div>
              <span class="color-hex">{{ currentColorScheme.headerText }}</span>
            </div>
          </ion-item>
        </div>

        <!-- Button Colors -->
        <div class="color-section">
          <h4>Button Colors</h4>
          <ion-item button (click)="openCustomColorPicker('buttonBackground', 'Button Background', $event)">
            <ion-label>Button Background</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.buttonBackground"></div>
              <span class="color-hex">{{ currentColorScheme.buttonBackground }}</span>
            </div>
          </ion-item>
          <ion-item button (click)="openCustomColorPicker('buttonText', 'Button Text', $event)">
            <ion-label>Button Text</ion-label>
            <div class="color-preview-container" slot="end">
              <div class="color-swatch" [style.background-color]="currentColorScheme.buttonText"></div>
              <span class="color-hex">{{ currentColorScheme.buttonText }}</span>
            </div>
          </ion-item>
        </div>

        <!-- Action Buttons -->
        <div class="color-actions">
          <ion-button expand="block" fill="outline" (click)="resetColors()">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Reset to Default
          </ion-button>
          <ion-button expand="block" (click)="previewColors()">
            <ion-icon name="eye" slot="start"></ion-icon>
            Preview Changes
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Text-to-Speech -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Text-to-Speech</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-icon name="language" slot="start"></ion-icon>
          <ion-select 
            [(ngModel)]="settings.ttsLanguage" 
            (ionChange)="onTtsLanguageChange()"
            placeholder="Select Language">
            <ion-select-option *ngFor="let lang of availableLanguages" [value]="lang.code">
              {{ lang.name }}
            </ion-select-option>
          </ion-select>
          <ion-label slot="start">Language</ion-label>
        </ion-item>

        <ion-item>
          <ion-icon name="speedometer" slot="start"></ion-icon>
          <ion-label>Speech Rate: {{ settings.ttsRate }}</ion-label>
          <ion-range 
            [(ngModel)]="settings.ttsRate"
            (ionChange)="onTtsRateChange()"
            min="0.5" 
            max="2.0" 
            step="0.1"
            snaps="true">
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-icon name="musical-notes" slot="start"></ion-icon>
          <ion-label>Pitch: {{ settings.ttsPitch }}</ion-label>
          <ion-range 
            [(ngModel)]="settings.ttsPitch"
            (ionChange)="onTtsPitchChange()"
            min="0.5" 
            max="2.0" 
            step="0.1"
            snaps="true">
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-icon name="volume-high" slot="start"></ion-icon>
          <ion-label>Auto-speak on flip</ion-label>
          <ion-toggle [(ngModel)]="settings.autoSpeak" (ionChange)="onAutoSpeakChange()"></ion-toggle>
        </ion-item>

        <ion-button expand="block" fill="outline" (click)="testTts()">
          <ion-icon name="play" slot="start"></ion-icon>
          Test Speech
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Study Settings -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Study Settings</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-icon name="layers" slot="start"></ion-icon>
          <ion-label>Max cards per session</ion-label>
          <ion-input 
            type="number" 
            [(ngModel)]="settings.maxCardsPerSession"
            (ionChange)="onMaxCardsChange()"
            min="5" 
            max="100">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-icon name="notifications" slot="start"></ion-icon>
          <ion-label>Study reminders</ion-label>
          <ion-toggle [(ngModel)]="settings.studyReminders" (ionChange)="onStudyRemindersChange()"></ion-toggle>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Images -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Images</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-icon name="image" slot="start"></ion-icon>
          <ion-select 
            [(ngModel)]="settings.imageQuality" 
            (ionChange)="onImageQualityChange()"
            placeholder="Select Quality">
            <ion-select-option *ngFor="let quality of imageQualities" [value]="quality.value">
              {{ quality.label }}
            </ion-select-option>
          </ion-select>
          <ion-label slot="start">Image Quality</ion-label>
        </ion-item>

        <ion-item>
          <ion-icon name="folder" slot="start"></ion-icon>
          <ion-label>
            <h3>Cache</h3>
            <p>{{ getCacheSize() }}</p>
          </ion-label>
          <ion-button fill="outline" size="small" (click)="clearImageCache()">
            Clear
          </ion-button>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Data Management -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Data Management</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="data-buttons">
          <ion-button expand="block" fill="outline" (click)="exportData()">
            <ion-icon name="download" slot="start"></ion-icon>
            Export Data
          </ion-button>

          <ion-button expand="block" fill="outline" (click)="importData()">
            <ion-icon name="cloud-upload" slot="start"></ion-icon>
            Import Data
          </ion-button>

          <ion-button expand="block" fill="outline" color="warning" (click)="resetAllSettings()">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Reset Settings
          </ion-button>

          <ion-button expand="block" fill="outline" color="danger" (click)="resetAllData()">
            <ion-icon name="trash" slot="start"></ion-icon>
            Delete All Data
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- App Info -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>About</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-icon name="information-circle" slot="start"></ion-icon>
          <ion-label>
            <h3>Flashcard App</h3>
            <p>Version 1.0.0</p>
            <p>Built with Ionic Angular & Capacitor</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
