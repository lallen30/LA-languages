<ion-header>
  <ion-toolbar>
    <ion-title>{{ 'settings.data' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()" aria-label="Close">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <!-- Loading Overlay -->
  <div *ngIf="isImporting" class="loading-overlay">
    <div class="loading-content">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>{{ 'settings.importing' | translate }}</p>
    </div>
  </div>

  <!-- Import Options Popup (shown when showImportOptions is true) -->
  <div *ngIf="showImportOptions" class="import-options-section">
    <ion-card>
      <ion-card-header [style.background]="buttonBackground">
        <ion-card-title [style.color]="buttonText">{{ 'settings.importData' | translate }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p class="import-description">{{ 'settings.chooseImportMethod' | translate }}</p>
        
        <!-- URL Input -->
        <div class="url-input-container">
          <ion-item>
            <ion-label position="stacked">{{ 'settings.importFromUrl' | translate }}</ion-label>
            <ion-input 
              type="url" 
              [(ngModel)]="importOptionsUrl" 
              placeholder="https://example.com/data.json"
              [clearInput]="true">
            </ion-input>
          </ion-item>
          <ion-button 
            expand="block" 
            [disabled]="!importOptionsUrl"
            (click)="importFromUrl()"
            [style.--background]="buttonBackground"
            [style.--color]="buttonText">
            <ion-icon name="cloud-download" slot="start"></ion-icon>
            {{ 'settings.importFromUrlBtn' | translate }}
          </ion-button>
        </div>
        
        <div class="divider">
          <span>{{ 'common.or' | translate }}</span>
        </div>
        
        <!-- Local File -->
        <ion-button 
          expand="block" 
          fill="outline"
          (click)="importFromLocalFile()"
          [style.--border-color]="buttonBackground"
          [style.color]="buttonBackground">
          <ion-icon name="folder-open" slot="start"></ion-icon>
          {{ 'settings.importFromFile' | translate }}
        </ion-button>
        
        <div class="cancel-button">
          <ion-button fill="clear" (click)="cancelImportOptions()">
            {{ 'common.cancel' | translate }}
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- URL Input Section (shown when showUrlInput is true) -->
  <div *ngIf="showUrlInput && !showImportOptions" class="url-input-section">
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ 'settings.importFromUrl' | translate }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>{{ 'settings.enterUrlForDecks' | translate }}</p>
        <ion-item>
          <ion-input 
            type="url" 
            [(ngModel)]="importUrl" 
            placeholder="https://example.com/decks.json"
            [clearInput]="true">
          </ion-input>
        </ion-item>
        <div class="url-buttons">
          <ion-button fill="outline" (click)="cancelUrlInput()">
            {{ 'common.cancel' | translate }}
          </ion-button>
          <ion-button [disabled]="!importUrl" (click)="submitUrlImport()">
            {{ 'settings.importData' | translate }}
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Main buttons (hidden when URL input is shown) -->
  <div class="data-buttons" *ngIf="!showUrlInput && !showImportOptions">
    <ion-button expand="block" fill="outline" (click)="handleExportData()">
      <ion-icon name="download" slot="start"></ion-icon>
      {{ 'settings.exportData' | translate }}
    </ion-button>
    <ion-button expand="block" fill="outline" (click)="handleImportData()">
      <ion-icon name="cloud-upload" slot="start"></ion-icon>
      {{ 'settings.importData' | translate }}
    </ion-button>
    <ion-button expand="block" fill="outline" color="secondary" (click)="handleImportMultipleDecks()">
      <ion-icon name="documents" slot="start"></ion-icon>
      {{ 'settings.importMultipleDecks' | translate }}
    </ion-button>
    <ion-button expand="block" fill="outline" color="secondary" (click)="showUrlInputSection()">
      <ion-icon name="link" slot="start"></ion-icon>
      {{ 'settings.importMultipleDecksFromUrl' | translate }}
    </ion-button>
    <ion-button expand="block" fill="outline" color="warning" (click)="handleResetSettings()">
      <ion-icon name="refresh" slot="start"></ion-icon>
      {{ 'settings.resetSettings' | translate }}
    </ion-button>
    <ion-button expand="block" fill="outline" color="danger" (click)="handleResetData()">
      <ion-icon name="trash" slot="start"></ion-icon>
      {{ 'settings.deleteAllData' | translate }}
    </ion-button>
  </div>
</ion-content>

<ion-footer>
  <div style="padding: 16px;">
    <ion-button 
      expand="block" 
      (click)="close()" 
      [style.--background]="buttonBackground"
      [style.--color]="buttonText">
      <ion-icon name="checkmark" slot="start"></ion-icon>
      {{ 'settings.done' | translate }}
    </ion-button>
  </div>
</ion-footer>
