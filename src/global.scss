/* ============================================================================
   global.scss  â€” safe baseline + scoped fixes
   ============================================================================ */

/* --- Ionic core + utilities (required) ------------------------------------ */
@import "@ionic/angular/css/core.css";
@import "@ionic/angular/css/normalize.css";
@import "@ionic/angular/css/structure.css";
@import "@ionic/angular/css/typography.css";
@import "@ionic/angular/css/display.css";

/* Optional Ionic utility imports */
@import "@ionic/angular/css/padding.css";
@import "@ionic/angular/css/float-elements.css";
@import "@ionic/angular/css/text-alignment.css";
@import "@ionic/angular/css/text-transformation.css";
@import "@ionic/angular/css/flex-utils.css";

/* --- App-wide base (safe; no structural overrides of Ionic components) ---- */
html, body {
  background: var(--ion-background-color);
  color: var(--ion-text-color);
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

ion-app {
  background: var(--ion-background-color);
  color: var(--ion-text-color);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

/* Ensure modals render properly */
ion-modal {
  z-index: 10000;
}

/* Custom session progress counter styling */
.session-progress-counter {
  font-weight: 600;
  font-size: 17px;
  white-space: nowrap;
}

/* Dark mode support for session progress counter */
body.dark .session-progress-counter {
  color: var(--ion-text-color, #ffffff) !important;
}

ion-content {
  background: var(--ion-background-color);
  color: var(--ion-text-color);
}

/* Smoother text rendering */
html {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Remove any accidental list bullets from custom content */
ul, ol { margin: 0; padding-left: 1.25rem; }

/* ============================================================================
   IMPORTANT: We intentionally DO NOT change layout of Ionic components here.
   The following risky patterns have been removed (do not re-add globally):
   - ion-item { display: block; }             // breaks internal flex row
   - ion-label { width: 100%; }               // causes end-slot to collapse
   - ion-item { --inner-padding-end: 0; }     // robs space from the end slot
   If you need tighter rows on a specific page, scope it (see below).
   ============================================================================ */

/* --- Page-scoped styling for the Settings page list ----------------------- */
/* Only affects the main Settings list, NOT modals */
/* Removed empty ruleset - add specific styles here if needed */

/* --- Scoped visual tweaks for the TTS modal (no layout overrides) --------- */
/* Keep only safe color tweaks; rely on native Ionic item layout */

/* Optional: ensure select/toggle look good regardless of theme variables */
ion-modal app-tts-modal ion-select::part(text),
ion-modal app-tts-modal ion-select::part(placeholder) {
  color: var(--ion-text-color, #111);
  opacity: 1;
}
ion-modal app-tts-modal ion-select::part(icon) {
  color: var(--ion-text-color, #111);
}
ion-modal app-tts-modal ion-toggle::part(track) {
  background: color-mix(in srgb, var(--ion-text-color, #111) 20%, transparent);
}
ion-modal app-tts-modal ion-toggle.toggle-checked::part(track) {
  background: color-mix(in srgb, var(--ion-color-primary, #428cff) 55%, transparent);
}
ion-modal app-tts-modal ion-toggle::part(handle) {
  background: #fff;
}

/* --- Small quality-of-life tweaks (safe) ---------------------------------- */
ion-button[fill="outline"] {
  --border-width: 2px;
}

/* --- Fullscreen modal utility -------------------------------------------- */
/* Applied from Settings via cssClass: 'modal-fullscreen' */
ion-modal.modal-fullscreen {
  /* Make the modal occupy the full viewport */
  --height: 100%;
  --max-height: 100%;
  --width: 100%;
  --border-radius: 0;
}

/* Ensure the shadow DOM content stretches fully */
ion-modal.modal-fullscreen::part(content) {
  height: 100%;
}

/* Optional: make inner ion-content fill too, in case components rely on it */
ion-modal.modal-fullscreen ion-content {
  height: 100%;
}

/* ============================================================================
   DARK MODE: Consistent header styling across all pages
   ============================================================================ */
body.dark {
  ion-header {
    ion-toolbar {
      --background: var(--ion-background-color, #1e1e1e);
      --color: var(--ion-toolbar-color, var(--ion-text-color, #ffffff));
      
      ion-title {
        color: var(--ion-toolbar-color, var(--ion-text-color, #ffffff));
      }
      
      ion-button {
        --color: var(--ion-toolbar-color, var(--ion-text-color, #ffffff));
      }
      
      ion-icon {
        color: var(--ion-toolbar-color, var(--ion-text-color, #ffffff));
      }
    }
  }
  
}

/* ============================================================================
   Android Safe Area: Add padding for status bar
   ============================================================================ */
.md ion-header {
  padding-top: env(safe-area-inset-top, 24px);
}

/* ============================================================================
   Faint header border for all pages (matching Home screen style)
   ============================================================================ */
ion-header ion-toolbar {
  --border-color: rgba(255, 255, 255, 0.1);
  --border-width: 0 0 0.55px 0;
}

/* Target the Decks page header border specifically */
app-decks ion-header ion-toolbar,
ion-header ion-toolbar:last-of-type {
  --border-color: rgba(255, 255, 255, 0.1) !important;
  --border-width: 0 0 0.55px 0 !important;
  border-bottom: 0.55px solid rgba(255, 255, 255, 0.1) !important;
}

/* Override any ::after pseudo-element border */
app-decks ion-header::after,
app-decks ion-toolbar::after {
  background: rgba(255, 255, 255, 0.1) !important;
  height: 0.55px !important;
  opacity: 1 !important;
}

/* ============================================================================
   DARK MODE: Action Sheet styling - Force dark mode for all action sheets
   ============================================================================ */

/* Force dark mode styling for ALL action sheets globally */
ion-action-sheet {
  --background: #2d2d2d !important;
  --button-background: #2d2d2d !important;
  --button-color: #4da3ff !important;
  --color: #b0b0b0 !important;
}

ion-action-sheet .action-sheet-wrapper {
  --background: #2d2d2d !important;
}

ion-action-sheet .action-sheet-container {
  background: #2d2d2d !important;
}

ion-action-sheet .action-sheet-group {
  background: #2d2d2d !important;
}

ion-action-sheet .action-sheet-group-cancel {
  background: #3a3a3c !important;
}

ion-action-sheet .action-sheet-title {
  color: #b0b0b0 !important;
  background: #2d2d2d !important;
}

ion-action-sheet .action-sheet-button {
  background: #2d2d2d !important;
  color: #4da3ff !important;
}

ion-action-sheet .action-sheet-button .action-sheet-button-inner {
  color: #4da3ff !important;
}

ion-action-sheet .action-sheet-button ion-icon {
  color: #4da3ff !important;
}

ion-action-sheet .action-sheet-button.action-sheet-destructive {
  color: #ff453a !important;
}

ion-action-sheet .action-sheet-button.action-sheet-destructive .action-sheet-button-inner {
  color: #ff453a !important;
}

ion-action-sheet .action-sheet-button.action-sheet-destructive ion-icon {
  color: #ff453a !important;
}

ion-action-sheet .action-sheet-cancel {
  background: #3a3a3c !important;
}

ion-action-sheet .action-sheet-cancel .action-sheet-button-inner {
  color: #4da3ff !important;
}

/* iOS-specific: Use ::part selectors for shadow DOM */
ion-action-sheet::part(container) {
  background: #2d2d2d !important;
}

ion-action-sheet::part(group) {
  background: #2d2d2d !important;
}

ion-action-sheet::part(button) {
  background: #2d2d2d !important;
  color: #4da3ff !important;
  text-align: left !important;
  justify-content: flex-start !important;
}

ion-action-sheet::part(button destructive) {
  color: #ff453a !important;
}

ion-action-sheet::part(cancel) {
  background: #3a3a3c !important;
}

/* Force left alignment for iOS action sheet buttons */
.ios ion-action-sheet .action-sheet-button {
  text-align: left !important;
  justify-content: flex-start !important;
}

.ios ion-action-sheet .action-sheet-button .action-sheet-button-inner {
  text-align: left !important;
  justify-content: flex-start !important;
}

/* ============================================================================
   DARK MODE: Alert/Popup styling - Force dark mode for all alerts
   ============================================================================ */
ion-alert {
  --background: #2d2d2d !important;
  --backdrop-opacity: 0.6 !important;
}

ion-alert .alert-wrapper {
  background: #2d2d2d !important;
  border-radius: 14px !important;
}

ion-alert .alert-head {
  background: #2d2d2d !important;
}

ion-alert .alert-title {
  color: #ffffff !important;
}

ion-alert .alert-sub-title {
  color: #b0b0b0 !important;
}

ion-alert .alert-message {
  color: #b0b0b0 !important;
  background: #2d2d2d !important;
}

ion-alert .alert-input-group {
  background: #2d2d2d !important;
}

ion-alert .alert-input {
  background: #3a3a3c !important;
  color: #ffffff !important;
  border-color: #4a4a4c !important;
}

ion-alert .alert-input::placeholder {
  color: #8e8e93 !important;
}

ion-alert .alert-button-group {
  background: #2d2d2d !important;
}

ion-alert .alert-button {
  color: #4da3ff !important;
  background: transparent !important;
}

ion-alert .alert-button.alert-button-role-cancel {
  color: #8e8e93 !important;
}

ion-alert .alert-button.alert-button-role-destructive {
  color: #ff453a !important;
}

/* iOS-specific: Use ::part selectors for shadow DOM */
ion-alert::part(container) {
  background: #2d2d2d !important;
}

ion-alert::part(header) {
  background: #2d2d2d !important;
}

ion-alert::part(message) {
  color: #b0b0b0 !important;
}

ion-alert::part(button) {
  color: #4da3ff !important;
}

/* ============================================================================
   Hex Input Alert - Ensure it appears above color picker overlay
   ============================================================================ */
ion-alert.hex-input-alert {
  z-index: 30000 !important;
}

ion-alert.hex-input-alert + ion-backdrop {
  z-index: 29999 !important;
}

/* ============================================================================
   Alert textarea styling - Make description fields larger
   ============================================================================ */
ion-alert textarea.alert-input {
  min-height: 100px !important;
  height: auto !important;
}

/* ============================================================================
   iOS CRITICAL FIX: Global clickability issue - NUCLEAR OPTION
   ============================================================================ */
@media (max-width: 768px) {
  /* Force hardware acceleration off to prevent compositing layer issues */
  * {
    transform: none !important;
    will-change: auto !important;
    backface-visibility: visible !important;
  }
  
  /* Ensure all clickable elements have proper touch targets */
  ion-button, ion-item, ion-tab-button, button, a {
    min-height: 44px !important;
  }
  
  /* Ensure content doesn't go under fixed tab bar */
  ion-content {
    --padding-bottom: 70px;
  }
  
  /* Ensure ion-item clicks work */
  ion-item::part(native) {
    min-height: 56px !important;
  }
}
